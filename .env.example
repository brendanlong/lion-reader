# =============================================================================
# Lion Reader Environment Variables
# =============================================================================
# Copy this file to .env and fill in the values for local development.
# For production (Fly.io), set these as secrets using: fly secrets set KEY=value

# =============================================================================
# Database (Required)
# =============================================================================
# PostgreSQL connection string
# Local development: postgresql://lionreader:lionreader@localhost:5432/lionreader
# Fly.io: Set automatically when attaching a Postgres database, or use:
#   fly secrets set DATABASE_URL="postgres://..."
#
# Note: Integration tests use a separate database (lionreader_test) configured
# in .env.test to avoid wiping dev data. The test database is created
# automatically by docker-compose. Run `pnpm db:migrate:test` to apply migrations.
DATABASE_URL=postgresql://lionreader:lionreader@localhost:5432/lionreader

# =============================================================================
# Redis (Required)
# =============================================================================
# Redis connection string for caching and pub/sub
# Local development: redis://localhost:6379
# Fly.io (Upstash): fly secrets set REDIS_URL="redis://..."
REDIS_URL=redis://localhost:6379

# =============================================================================
# Application (Required for Production)
# =============================================================================
# Environment: development | production | test
NODE_ENV=development

# Port for the application server (default: 3000)
# Usually set automatically by the hosting platform
PORT=3000

# Base URL for the application (used for generating absolute URLs)
# Required for OAuth callbacks and WebSub
# Example: https://lion-reader.fly.dev or https://yourdomain.com
# NEXT_PUBLIC_APP_URL=http://localhost:3000

# =============================================================================
# Signup & Admin (Optional)
# =============================================================================
# By default, Lion Reader runs in invite-only mode.
# Set to "true" to allow anyone to register without an invite.
ALLOW_ALL_SIGNUPS=false

# Secret for admin API endpoints (invite management).
# Required when running in invite-only mode (ALLOW_ALL_SIGNUPS=false).
# Generate a secure random string: openssl rand -base64 32
# ALLOWLIST_SECRET=your-secure-secret-here

# =============================================================================
# Email Newsletters (Optional)
# =============================================================================
# Lion Reader can receive email newsletters via custom ingest addresses.
# Each user gets unique addresses like: {token}@ingest.yourdomain.com

# Domain for ingest email addresses
# This domain must have MX records pointing to Cloudflare Email Workers
# Default: ingest.lionreader.com
# INGEST_EMAIL_DOMAIN=ingest.yourdomain.com

# Webhook secret for authenticating email forwarding from Cloudflare Email Workers
# Required to enable email newsletter feature
# Generate a secure random string: openssl rand -base64 32
# EMAIL_WEBHOOK_SECRET=your-secure-webhook-secret

# =============================================================================
# AI Features (Optional)
# =============================================================================
# Groq API key for AI-powered narration text processing
# Get from: https://console.groq.com/keys
# If not set, narration falls back to simple HTML-to-text conversion
# GROQ_API_KEY=gsk_...

# =============================================================================
# OAuth Providers (Optional)
# =============================================================================
# Google OAuth - Enable "Sign in with Google"
# Create credentials at: https://console.cloud.google.com/apis/credentials
# GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
# GOOGLE_CLIENT_SECRET=your-client-secret

# Apple OAuth - Enable "Sign in with Apple"
# Create a Service ID at: https://developer.apple.com/account/resources/identifiers
# APPLE_CLIENT_ID=com.yourdomain.lionreader
# APPLE_TEAM_ID=your-team-id
# APPLE_KEY_ID=your-key-id
# APPLE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----"

# =============================================================================
# Observability (Optional)
# =============================================================================
# Sentry DSN for error tracking
# Get from: https://sentry.io/settings/projects/<project>/keys/

# For server-side errors:
# SENTRY_DSN=https://...@sentry.io/...

# For client-side errors (must be NEXT_PUBLIC_ for browser access):
# NEXT_PUBLIC_SENTRY_DSN=https://...@sentry.io/...

# Auth token for uploading source maps (CI/CD only):
# SENTRY_AUTH_TOKEN=sntrys_...

# Prometheus metrics endpoint (/api/metrics)
# Set to "true" to enable metrics collection
# METRICS_ENABLED=false

# Basic auth for /api/metrics endpoint (recommended if METRICS_ENABLED=true)
# METRICS_USERNAME=prometheus
# METRICS_PASSWORD=your-secure-password

# =============================================================================
# Fly.io Secrets (Production)
# =============================================================================
# The following should be set as Fly.io secrets, NOT in environment files:
#
# Required:
#   fly secrets set DATABASE_URL="postgres://..."
#   fly secrets set REDIS_URL="redis://..."
#
# Signup/Admin:
#   fly secrets set ALLOW_ALL_SIGNUPS="true"  # or keep false for invite-only
#   fly secrets set ALLOWLIST_SECRET="your-secure-secret"
#
# AI Features:
#   fly secrets set GROQ_API_KEY="gsk_..."
#
# OAuth Providers:
#   fly secrets set GOOGLE_CLIENT_ID="..."
#   fly secrets set GOOGLE_CLIENT_SECRET="..."
#   fly secrets set APPLE_CLIENT_ID="..."
#   fly secrets set APPLE_TEAM_ID="..."
#   fly secrets set APPLE_KEY_ID="..."
#   fly secrets set APPLE_PRIVATE_KEY="..."
#
# Email Newsletters:
#   fly secrets set INGEST_EMAIL_DOMAIN="ingest.yourdomain.com"
#   fly secrets set EMAIL_WEBHOOK_SECRET="your-secure-webhook-secret"
#
# Observability:
#   fly secrets set SENTRY_DSN="https://...@sentry.io/..."
#   fly secrets set NEXT_PUBLIC_SENTRY_DSN="https://...@sentry.io/..."
#   fly secrets set SENTRY_AUTH_TOKEN="sntrys_..."
#   fly secrets set METRICS_ENABLED="true"
#   fly secrets set METRICS_USERNAME="prometheus"
#   fly secrets set METRICS_PASSWORD="..."
#
# The DATABASE_URL is typically set automatically when you run:
#   fly postgres attach <postgres-app-name>
